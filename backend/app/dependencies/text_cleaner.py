import re

def clean_telegram_post(text: str) -> str:
    """
    Очищает Telegram-пост от:
    - ссылок (Markdown, URL, t.me, приглашения)
    - упоминаний (@...)
    - эмодзи
    - рекламных блоков (на основе каналов @mtyva_bot, @prokzl и описания +Vf8kMe9-6txmZTAy)
    - служебных фраз («Присылайте», «По рекламе», «Заплачу» и т.д.)
    - мусорных ID и хештегов (#2WMY0)

    Возвращает чистый текст, пригодный для препроцессинга и классификации.
    """
    if not text:
        return ""

    # 1. Удалить Markdown-ссылки полностью: [текст](ссылка)
    text = re.sub(r'\s*\[[^]]*\]\([^)]*\)\s*', '\n', text)

    # 2. Удалить все URL и t.me-ссылки (включая приглашения вида t.me/+...)
    text = re.sub(r'https?://\S+|t\.me/[^\s\)\]\n]+', '', text, flags=re.IGNORECASE)

    # 3. Удалить упоминания (@username)
    text = re.sub(r'@[a-zA-Z0-9_]+', '', text)

    # 4. Удалить эмодзи
    emoji_pattern = re.compile(
        "["
        "\U0001F600-\U0001F64F"  # эмоции
        "\U0001F300-\U0001F5FF"  # символы/пиктограммы
        "\U0001F680-\U0001F6FF"  # транспорт
        "\U0001F1E0-\U0001F1FF"  # флаги
        "\U00002702-\U000027B0"
        "\U000024C2-\U0001F251"
        "]+",
        flags=re.UNICODE,
    )
    text = emoji_pattern.sub(r'', text)

    # 5. Удалить рекламные фразы (точно под каналы из knowledge base)
    ad_patterns = [
        # Из описания канала +Vf8kMe9-6txmZTAy:
        r'прислать фото.*',
        r'прислать видео.*',
        r'любую информацию.*',
        r'пригласить друга.*',
        r'по рекламе.*',
        r'№\s*\d{10}',  # номер 6010050555
        r'#\w{5,}',     # хештеги вроде #2WMY0

        # Из описания @mtyva_bot:
        r'присылайте мне.*',
        r'всё, что происходит.*',
        r'если новость эксклюзивная.*',
        r'заплачу.*',
        r'красивые фото приветствуются.*',
        r'manager тыва',
        r'launch.*right away',

        # Общие служебные фразы:
        r'(?:по вопросам|контакты?|сотрудничество|реклама)\s*[:\-—]?\s*\S.*',
        r'номер для рекламы.*',
        r'бот\s*@?\w+',
    ]

    for pattern in ad_patterns:
        text = re.sub(rf'(?im)\s*{pattern}.*?$', '', text)

    # 6. Удалить остаточные "мусорные" символы, оставить только:
    # буквы, пробелы, дефисы, кавычки («», "", ''), пунктуацию (. , : ; ! ? ( ) —)
    text = re.sub(r'[^\w\s\-\«\»\"\'\.\,\:\;\!\?\(\)\—]', ' ', text)

    # 7. Почистить whitespace
    text = re.sub(r'\n\s*\n', '\n\n', text)        # 2+ пустых строки → 2
    text = re.sub(r'[ \t]+', ' ', text)            # множественные пробелы → 1
    text = re.sub(r'^\s+|\s+$', '', text, flags=re.MULTILINE)
    text = re.sub(r'\n{3,}', '\n\n', text)

    return text.strip()